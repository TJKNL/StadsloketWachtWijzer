<!DOCTYPE html>
<html lang="{{ lang|default('nl') }}">
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4XECBEDSBR"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          
          // Check for consent cookie before enabling tracking
          const hasConsent = document.cookie.split(';').some(c => c.trim().startsWith('analytics_consent='));
          if(hasConsent) {
            gtag('config', 'G-4XECBEDSBR');
          } else {
            // No tracking until consent is given, still initialize but with analytics_storage: 'denied'
            gtag('config', 'G-4XECBEDSBR', { 'analytics_storage': 'denied' });
          }
        </script>
        
        <!-- Primary Meta Tags -->
        <meta charset="UTF-8">
        <title>WachtWijzer Stadsloketten Amsterdam | Live Actuele Wachttijden</title>
        <meta name="description" content="Bekijk direct de actuele wachttijden bij alle stadsloketten in Amsterdam. Vind het loket met de kortste wachttijd en bespaar tijd bij uw bezoek aan het stadsloket.">
        <meta name="keywords" content="wachttijden stadsloketten Amsterdam, Amsterdam stadsloket wachtrij, gemeente Amsterdam wachttijd, actuele wachtrijen stadsloketten, wachttijden gemeente Amsterdam">
        <meta name="author" content="Twan Kerkhof">
        
        <!-- Canonical URL - Adding this to help search engines understand this is the main page -->
        <link rel="canonical" href="{{ request.url_root }}" />
        
        <!-- Language alternates for SEO -->
        <link rel="alternate" hreflang="nl" href="{{ request.url_root }}?lang=nl" />
        <link rel="alternate" hreflang="en" href="{{ request.url_root }}?lang=en" />
        <link rel="alternate" hreflang="x-default" href="{{ request.url_root }}" />
        
        <!-- Viewport and Favicon -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
        <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="{{ request.url }}">
        <meta property="og:title" content="Wachttijden Stadsloketten Amsterdam | Actuele Informatie">
        <meta property="og:description" content="Bekijk actuele wachttijden bij alle stadsloketten in Amsterdam. Vind het loket met de kortste wachttijd en plan uw bezoek efficiënt.">
        <meta property="og:image" content="{{ url_for('static', filename='images/hero_design_remove_bg_cropped.png', _external=True) }}">
        
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="{{ request.url }}">
        <meta property="twitter:title" content="Wachttijden Stadsloketten Amsterdam | Actuele Informatie">
        <meta property="twitter:description" content="Bekijk actuele wachttijden bij alle stadsloketten in Amsterdam. Vind het loket met de kortste wachttijd en plan uw bezoek efficiënt.">
        <meta property="twitter:image" content="{{ url_for('static', filename='images/hero_design_remove_bg_cropped.png', _external=True) }}">
        
        <!-- Structured Data -->
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "WebApplication",
          "name": "Wachttijden Stadsloketten Amsterdam",
          "description": "Bekijk actuele wachttijden bij alle stadsloketten in Amsterdam",
          "url": "{{ request.url_root }}",
          "applicationCategory": "UtilityApplication",
          "operatingSystem": "All",
          "keywords": "wachttijden, stadsloketten, Amsterdam, wachtrij, gemeente",
          "offers": {
            "@type": "Offer",
            "price": "0"
          },
          "provider": {
            "@type": "Person",
            "name": "Twan Kerkhof"
          },
          "audience": {
            "@type": "Audience",
            "audienceType": "Inwoners Amsterdam"
          }
        }
        </script>
        
        <!-- Preconnect to CDNs -->
        <link rel="preconnect" href="https://cdnjs.cloudflare.com">
        <link rel="preconnect" href="https://cdn.jsdelivr.net">
        
        <!-- Stylesheets -->
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js" defer></script>
        
        <!-- Cache control -->
        <meta http-equiv="Cache-Control" content="max-age=1800">
    </head>
<body>
    <!-- Cookie Consent Banner - Redesigned as a bento box -->
    <div id="cookie-consent" class="cookie-bento">
        <h3><i class="fas fa-cookie-bite"></i> Cookie Toestemming</h3>
        <p>We gebruiken cookies voor analyse en een betere ervaring.</p>
        <div class="cookie-buttons">
            <button id="cookie-accept" class="cookie-btn accept">Accepteren</button>
            <button id="cookie-decline" class="cookie-btn decline">Weigeren</button>
        </div>
        <a href="{{ url_for('privacy') }}" class="cookie-policy-link">Meer info</a>
    </div>

    <header class="hero">
        <div class="hero-content">
            <h1>Wachttijden Stadsloketten Amsterdam</h1>
            <p>Live actuele wachtrijen bij alle Amsterdamse stadsloketten</p>
        </div>
        <div class="hero-image">
            <img src="{{ url_for('static', filename='images/hero_design_remove_bg_cropped.png') }}" alt="Amsterdam stadsloketten wachttijden">
        </div>
    </header>
    
    <!-- Breadcrumb navigation for SEO - Updated to match site style -->
    <div class="breadcrumb">
        <div class="content-container">
            <span>
                <a href="{{ request.url_root }}">Home</a> »
                <span>Wachttijden Stadsloketten Amsterdam</span>
            </span>
        </div>
    </div>

    <!-- Add the last updated information below the header -->
    <div class="data-status">
        {% if last_update %}
        <p><i class="fas fa-sync-alt"></i> Data last updated: {{ last_update.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        {% else %}
        <p><i class="fas fa-exclamation-triangle"></i> Update time information unavailable</p>
        {% endif %}
    </div>

    {% if best_loket %}
    <div class="bento">
        <div class="best-loket">
            <h2><i class="fas fa-star"></i> Recommended Location</h2>
            <p><i class="fas fa-building"></i> {{ best_loket[1] }}</p>
            <p><i class="fas fa-clock"></i> Average wait: {{ best_loket[2] }} minutes</p>
            <p><i class="fas fa-users"></i> Currently waiting: {{ best_loket[3] }} people</p>
        </div>
    </div>
    {% endif %}

    <div class="bento">
        {% for loket in loket_data %}
        <div>
            <h3><i class="fas fa-building"></i> {{ loket[1] }}</h3>
            <p><i class="fas fa-clock"></i> Average wait: {{ loket[2] }} minutes</p>
            <p><i class="fas fa-users"></i> Currently waiting: {{ loket[3] }} people</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- Daily Seasonality Chart Section -->
    <div class="chart-container">
        <h2>Daily Wait Time Patterns</h2>
        <p>Average wait times in minutes throughout the day (8:00-18:00)</p>
        <canvas id="seasonalityChart"></canvas>
    </div>
    
    <!-- FAQ Section - Updated to match bento box style -->
    <section class="faq-section">
        <h2>Veelgestelde vragen:</h2>
        
        <div class="faq-items">
            <div class="faq-item">
                <h3><i class="fas fa-question-circle"></i> Hoe lang is de wachttijd bij stadsloketten Amsterdam?</h3>
                <p>De wachttijden verschillen per stadsloket en per dagdeel. Bovenaan deze pagina ziet u de actuele wachttijden bij elk stadsloket in Amsterdam. De gemiddelde wachttijd varieert meestal tussen 5 en 30 minuten.</p>
            </div>
            
            <div class="faq-item">
                <h3><i class="fas fa-map-marker-alt"></i> Welk stadsloket in Amsterdam heeft de kortste wachttijd?</h3>
                <p>Bovenaan deze pagina tonen we het aanbevolen stadsloket met de kortste wachttijd op dit moment. Dit wordt real-time bijgewerkt om u te helpen tijd te besparen.</p>
            </div>
            
            <div class="faq-item">
                <h3><i class="fas fa-clock"></i> Wanneer zijn de wachttijden het kortst?</h3>
                <p>Uit onze gegevens blijkt dat de wachttijden meestal het kortst zijn in de ochtend (8:00-10:00) en aan het einde van de middag (15:00-17:00). De drukste tijden zijn meestal rond lunchtijd (12:00-14:00).</p>
            </div>
            
            <div class="faq-item">
                <h3><i class="fas fa-calendar-check"></i> Moet ik een afspraak maken?</h3>
                <p>Voor alle diensten bij stadsloketten in Amsterdam is geen afspraak nodig. Alleen voor het stadsloket in Weesp moeten u altijd een afspraak maken. Kijk voor meer informatie op <a href="https://www.amsterdam.nl/contact/" target="_blank">officiële website van de gemeente Amsterdam</a>.</p>
            </div>
        </div>
    </section>
    
    <script>
        // Fetch hourly data and create chart
        fetch('/hourly_data')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('seasonalityChart').getContext('2d');
                
                // Generate unique colors for each dataset
                data.datasets.forEach((dataset, index) => {
                    const hue = (index * 137) % 360; // Golden angle approximation for color distribution
                    dataset.borderColor = `hsl(${hue}, 70%, 45%)`;
                    dataset.backgroundColor = `hsl(${hue}, 70%, 85%, 0.2)`;
                    dataset.tension = 0.3;
                    dataset.pointRadius = 3;
                    dataset.pointHoverRadius = 5;
                });
                
                new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Average wait time (minutes)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time of day'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            })
            .catch(error => console.error('Error loading chart data:', error));

        // Cookie consent functionality
        document.addEventListener('DOMContentLoaded', function() {
            const cookieBanner = document.getElementById('cookie-consent');
            const acceptBtn = document.getElementById('cookie-accept');
            const declineBtn = document.getElementById('cookie-decline');
            
            // Check if user has already made a choice
            const hasConsent = document.cookie.split(';').some(c => c.trim().startsWith('analytics_consent='));
            
            // Hide banner if consent already given or explicitly declined
            if (hasConsent) {
                cookieBanner.style.display = 'none';
            }
            
            acceptBtn.addEventListener('click', function() {
                // Set consent cookie that expires in 365 days
                document.cookie = 'analytics_consent=true; max-age=' + (86400 * 365) + '; path=/; SameSite=Lax';
                cookieBanner.style.display = 'none';
                
                // Now enable analytics since user accepted
                gtag('consent', 'update', {
                    'analytics_storage': 'granted'
                });
                
                // Trigger pageview after consent
                gtag('config', 'G-4XECBEDSBR', { 'send_page_view': true });
            });
            
            declineBtn.addEventListener('click', function() {
                // Set negative consent cookie so we don't ask again
                document.cookie = 'analytics_consent=false; max-age=' + (86400 * 365) + '; path=/; SameSite=Lax';
                cookieBanner.style.display = 'none';
            });
        });
    </script>

    <footer class="footer">
        <p>© 2025 <a href="https://www.twankerkhof.nl" target="_blank">Twan Kerkhof</a> | Real-time wachttijden stadsloketten Amsterdam</p>
        <p style="color: #999;">Deze website is een onafhankelijk initiatief en heeft geen officiële relatie met de gemeente Amsterdam.</p>
        <nav class="footer-nav">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('privacy') }}">Privacybeleid</a>
        </nav>
    </footer>
</body>
</html>

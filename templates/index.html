<!DOCTYPE html>
<html>
<head>
    <title>Amsterdam Stadsloket Wait Times</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
</head>
<body>
    <header class="hero">
        <h1>Stadsloket Wait Times</h1>
        <p>Real-time insights for Amsterdam city services</p>
    </header>

    {% if best_loket %}
    <div class="bento">
        <div class="best-loket">
            <h2><i class="fas fa-star"></i> Recommended Location</h2>
            <p><i class="fas fa-building"></i> {{ best_loket[1] }}</p>
            <p><i class="fas fa-clock"></i> Average wait: {{ best_loket[2] }} minutes</p>
            <p><i class="fas fa-users"></i> Currently waiting: {{ best_loket[3] }} people</p>
        </div>
    </div>
    {% endif %}

    <div class="bento">
        {% for loket in loket_data %}
        <div>
            <h3><i class="fas fa-building"></i> {{ loket[1] }}</h3>
            <p><i class="fas fa-clock"></i> Average wait: {{ loket[2] }} minutes</p>
            <p><i class="fas fa-users"></i> Currently waiting: {{ loket[3] }} people</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- Daily Seasonality Chart Section -->
    <div class="chart-container">
        <h2>Daily Wait Time Patterns</h2>
        <p>Average wait times in minutes throughout the day (8:00-18:00)</p>
        <canvas id="seasonalityChart"></canvas>
    </div>
    
    <script>
        // Fetch hourly data and create chart
        fetch('/hourly_data')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('seasonalityChart').getContext('2d');
                
                // Generate unique colors for each dataset
                data.datasets.forEach((dataset, index) => {
                    const hue = (index * 137) % 360; // Golden angle approximation for color distribution
                    dataset.borderColor = `hsl(${hue}, 70%, 45%)`;
                    dataset.backgroundColor = `hsl(${hue}, 70%, 85%, 0.2)`;
                    dataset.tension = 0.3;
                    dataset.pointRadius = 3;
                    dataset.pointHoverRadius = 5;
                });
                
                new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Average wait time (minutes)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time of day'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            })
            .catch(error => console.error('Error loading chart data:', error));
    </script>

    <footer class="footer">
        <p>Â© 2025 <a href="https://www.twankerkhof.nl" target="_blank">Twan Kerkhof</a> | Real-time waiting information stadsloketten Amsterdam</p>
    </footer>
</body>
</html>
